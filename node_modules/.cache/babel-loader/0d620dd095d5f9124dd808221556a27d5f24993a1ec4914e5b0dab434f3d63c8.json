{"ast":null,"code":"import React,{useState,useEffect,useRef,useContext,useCallback}from'react';import{ChatContext}from'../context/ChatContext';import{AuthContext}from'../context/AuthContext';import{ThemeContext}from'../context/ThemeContext';import{jsx as _jsx,jsxs as _jsxs,Fragment as _Fragment}from\"react/jsx-runtime\";const Chat=_ref=>{let{chatId,title,height='500px',fullWidth=false}=_ref;const{user}=useContext(AuthContext);const{darkMode}=useContext(ThemeContext);const{getChatMessages,sendMessage,deleteMessage,fetchMessages,joinChatRoom,leaveChatRoom,connectionStatus,error:chatError,reconnect}=useContext(ChatContext);const[newMessage,setNewMessage]=useState('');const[sending,setSending]=useState(false);const[loading,setLoading]=useState(true);const[error,setError]=useState('');const[reconnecting,setReconnecting]=useState(false);const messagesEndRef=useRef(null);const messageInputRef=useRef(null);const reconnectTimerRef=useRef(null);const messages=getChatMessages(chatId);const previousChatIdRef=useRef(chatId);// Load messages and join chat room\nuseEffect(()=>{let isMounted=true;const initChat=async()=>{if(!isMounted)return;setLoading(true);setError('');try{if(chatId&&chatId!==previousChatIdRef.current){// Leave previous room if different\nif(previousChatIdRef.current){leaveChatRoom(previousChatIdRef.current);}// Join new room\njoinChatRoom(chatId);previousChatIdRef.current=chatId;await fetchMessages(chatId);}else if(chatId&&!messages.length){// If same room but no messages (first load), join and fetch\njoinChatRoom(chatId);await fetchMessages(chatId);}}catch(err){console.error('Error initializing chat:',err);if(isMounted){setError('Failed to load chat. Please try reloading the page.');}}finally{if(isMounted){var _messageInputRef$curr;setLoading(false);// Focus the input field\n(_messageInputRef$curr=messageInputRef.current)===null||_messageInputRef$curr===void 0?void 0:_messageInputRef$curr.focus();}}};initChat();// Clean up when unmounting or changing chat\nreturn()=>{isMounted=false;// Only leave if component is unmounting or chat is changing\nif(chatId&&chatId===previousChatIdRef.current){leaveChatRoom(chatId);}// Clear any reconnect timers\nif(reconnectTimerRef.current){clearTimeout(reconnectTimerRef.current);reconnectTimerRef.current=null;}};},[chatId]);// Watch for connection status changes\nuseEffect(()=>{if(connectionStatus==='connecting'){setReconnecting(true);}else if(connectionStatus==='connected'){setReconnecting(false);if(error&&error.includes('connection')){setError('');}}else if(connectionStatus==='disconnected'&&!reconnecting){setReconnecting(true);}},[connectionStatus,error,reconnecting]);// Update error from context\nuseEffect(()=>{if(chatError){setError(chatError);}},[chatError]);// Scroll to bottom when messages change\nuseEffect(()=>{scrollToBottom();},[messages]);const scrollToBottom=()=>{var _messagesEndRef$curre;(_messagesEndRef$curre=messagesEndRef.current)===null||_messagesEndRef$curre===void 0?void 0:_messagesEndRef$curre.scrollIntoView({behavior:'smooth'});};const handleSendMessage=async e=>{e.preventDefault();const messageText=newMessage.trim();if(!messageText||sending||connectionStatus!=='connected')return;try{var _messageInputRef$curr2;setSending(true);setError('');// Clear input immediately for better UX\nsetNewMessage('');// Send the message\nawait sendMessage(chatId,messageText);// Focus back on input field\n(_messageInputRef$curr2=messageInputRef.current)===null||_messageInputRef$curr2===void 0?void 0:_messageInputRef$curr2.focus();}catch(err){console.error('Failed to send message:',err);setError(err.message||'Failed to send message. Please try again.');}finally{setSending(false);}};const handleDeleteMessage=async messageId=>{if(!window.confirm('Are you sure you want to delete this message?')){return;}try{setError('');await deleteMessage(chatId,messageId);}catch(err){console.error('Failed to delete message:',err);setError(err.message||'Failed to delete message. Please try again.');}};const formatMessageTime=timestamp=>{try{const date=new Date(timestamp);return date.toLocaleTimeString([],{hour:'2-digit',minute:'2-digit'});}catch(err){return'';}};// Check if a message was sent by the current user\nconst isOwnMessage=message=>{var _message$userId;return((_message$userId=message.userId)===null||_message$userId===void 0?void 0:_message$userId._id)===(user===null||user===void 0?void 0:user._id);};// Connection status indicator\nconst getConnectionStatusIndicator=()=>{switch(connectionStatus){case'connected':return/*#__PURE__*/_jsxs(\"div\",{className:\"text-xs flex items-center text-green-600 dark:text-green-400\",children:[/*#__PURE__*/_jsx(\"span\",{className:\"h-2 w-2 rounded-full bg-green-600 dark:bg-green-400 mr-1\"}),\"Connected\"]});case'connecting':return/*#__PURE__*/_jsxs(\"div\",{className:\"text-xs flex items-center text-yellow-600 dark:text-yellow-400\",children:[/*#__PURE__*/_jsx(\"span\",{className:\"h-2 w-2 rounded-full bg-yellow-600 dark:bg-yellow-400 mr-1 animate-pulse\"}),\"Connecting...\"]});case'disconnected':return/*#__PURE__*/_jsxs(\"div\",{className:\"text-xs flex items-center text-red-600 dark:text-red-400\",children:[/*#__PURE__*/_jsx(\"span\",{className:\"h-2 w-2 rounded-full bg-red-600 dark:bg-red-400 mr-1 \".concat(reconnecting?'animate-pulse':'')}),reconnecting?'Reconnecting...':'Disconnected']});case'error':return/*#__PURE__*/_jsxs(\"div\",{className:\"text-xs flex items-center text-red-600 dark:text-red-400\",children:[/*#__PURE__*/_jsx(\"span\",{className:\"h-2 w-2 rounded-full bg-red-600 dark:bg-red-400 mr-1\"}),\"Connection Error\",/*#__PURE__*/_jsx(\"button\",{onClick:handleRetryConnection,className:\"ml-2 underline text-primary-600 dark:text-primary-400 hover:text-primary-800 dark:hover:text-primary-300\",children:\"Retry\"})]});default:return null;}};// Handle retry connection\nconst handleRetryConnection=useCallback(()=>{setReconnecting(true);setError('');reconnect();},[reconnect]);return/*#__PURE__*/_jsxs(\"div\",{className:\"flex flex-col rounded-lg shadow-md border border-gray-200 dark:border-gray-700 bg-white dark:bg-gray-800 overflow-hidden \".concat(fullWidth?'w-full':'max-w-3xl'),style:{height},children:[/*#__PURE__*/_jsxs(\"div\",{className:\"p-3 border-b border-gray-200 dark:border-gray-700 bg-gray-50 dark:bg-gray-700 flex justify-between items-center\",children:[/*#__PURE__*/_jsx(\"h3\",{className:\"font-medium dark:text-white\",children:title||'Chat'}),getConnectionStatusIndicator()]}),/*#__PURE__*/_jsxs(\"div\",{className:\"flex-1 overflow-y-auto p-4 bg-gray-50 dark:bg-gray-800\",children:[loading?/*#__PURE__*/_jsx(\"div\",{className:\"flex justify-center items-center h-full\",children:/*#__PURE__*/_jsx(\"div\",{className:\"linear-spinner dark:border-gray-600 dark:border-t-primary-400\"})}):connectionStatus==='error'?/*#__PURE__*/_jsxs(\"div\",{className:\"flex flex-col items-center justify-center h-full text-gray-600 dark:text-gray-400\",children:[/*#__PURE__*/_jsx(\"svg\",{xmlns:\"http://www.w3.org/2000/svg\",className:\"h-12 w-12 mb-3 text-red-500 dark:text-red-400\",fill:\"none\",viewBox:\"0 0 24 24\",stroke:\"currentColor\",children:/*#__PURE__*/_jsx(\"path\",{strokeLinecap:\"round\",strokeLinejoin:\"round\",strokeWidth:1.5,d:\"M12 9v2m0 4h.01m-6.938 4h13.856c1.54 0 2.502-1.667 1.732-3L13.732 4c-.77-1.333-2.694-1.333-3.464 0L3.34 16c-.77 1.333.192 3 1.732 3z\"})}),/*#__PURE__*/_jsx(\"p\",{className:\"text-center mb-2\",children:\"Connection lost to the chat server\"}),/*#__PURE__*/_jsx(\"button\",{onClick:handleRetryConnection,className:\"px-4 py-2 bg-primary-600 hover:bg-primary-700 text-white rounded-md transition-colors duration-150 flex items-center\",children:reconnecting?/*#__PURE__*/_jsxs(_Fragment,{children:[/*#__PURE__*/_jsxs(\"svg\",{className:\"animate-spin -ml-1 mr-2 h-4 w-4 text-white\",xmlns:\"http://www.w3.org/2000/svg\",fill:\"none\",viewBox:\"0 0 24 24\",children:[/*#__PURE__*/_jsx(\"circle\",{className:\"opacity-25\",cx:\"12\",cy:\"12\",r:\"10\",stroke:\"currentColor\",strokeWidth:\"4\"}),/*#__PURE__*/_jsx(\"path\",{className:\"opacity-75\",fill:\"currentColor\",d:\"M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z\"})]}),\"Reconnecting...\"]}):'Reconnect'})]}):messages.length===0?/*#__PURE__*/_jsxs(\"div\",{className:\"flex flex-col items-center justify-center h-full text-gray-500 dark:text-gray-400\",children:[/*#__PURE__*/_jsx(\"svg\",{xmlns:\"http://www.w3.org/2000/svg\",className:\"h-12 w-12 mb-2\",fill:\"none\",viewBox:\"0 0 24 24\",stroke:\"currentColor\",children:/*#__PURE__*/_jsx(\"path\",{strokeLinecap:\"round\",strokeLinejoin:\"round\",strokeWidth:1,d:\"M8 12h.01M12 12h.01M16 12h.01M21 12c0 4.418-4.03 8-9 8a9.863 9.863 0 01-4.255-.949L3 20l1.395-3.72C3.512 15.042 3 13.574 3 12c0-4.418 4.03-8 9-8s9 3.582 9 8z\"})}),/*#__PURE__*/_jsx(\"p\",{children:\"No messages yet\"}),/*#__PURE__*/_jsx(\"p\",{className:\"text-sm mt-1\",children:\"Start the conversation!\"})]}):/*#__PURE__*/_jsxs(\"div\",{className:\"space-y-4\",children:[messages.map(message=>{var _message$userId2,_message$userId2$disp,_message$userId3;return/*#__PURE__*/_jsx(\"div\",{className:\"flex \".concat(isOwnMessage(message)?'justify-end':'justify-start'),children:/*#__PURE__*/_jsxs(\"div\",{className:\"flex max-w-[80%] \".concat(isOwnMessage(message)?'flex-row-reverse':''),children:[/*#__PURE__*/_jsx(\"div\",{className:\"flex-shrink-0\",children:/*#__PURE__*/_jsx(\"div\",{className:\"linear-avatar linear-avatar-sm dark:bg-gray-700\",children:message.userId&&message.userId.photo?/*#__PURE__*/_jsx(\"img\",{src:message.userId.photo,alt:message.userId.displayName||'User',className:\"h-full w-full object-cover rounded-full\"}):/*#__PURE__*/_jsx(\"span\",{children:((_message$userId2=message.userId)===null||_message$userId2===void 0?void 0:(_message$userId2$disp=_message$userId2.displayName)===null||_message$userId2$disp===void 0?void 0:_message$userId2$disp.charAt(0))||'?'})})}),/*#__PURE__*/_jsxs(\"div\",{className:\"mx-2 \".concat(isOwnMessage(message)?'text-right':''),children:[/*#__PURE__*/_jsxs(\"div\",{className:\"flex items-center mb-1\",children:[/*#__PURE__*/_jsx(\"p\",{className:\"text-xs text-gray-500 dark:text-gray-400 \".concat(isOwnMessage(message)?'mr-2':'ml-0 mr-2'),children:formatMessageTime(message.createdAt)}),/*#__PURE__*/_jsx(\"p\",{className:\"text-sm font-medium dark:text-white\",children:((_message$userId3=message.userId)===null||_message$userId3===void 0?void 0:_message$userId3.displayName)||'Anonymous'})]}),/*#__PURE__*/_jsx(\"div\",{className:\"rounded-lg p-3 \".concat(isOwnMessage(message)?'bg-primary-100 dark:bg-primary-900/30 text-gray-900 dark:text-gray-100':'bg-gray-100 dark:bg-gray-700 text-gray-900 dark:text-gray-100',\" \").concat(message.isOptimistic?'opacity-70':''),children:/*#__PURE__*/_jsx(\"p\",{className:\"text-sm whitespace-pre-wrap break-words\",children:message.message})}),isOwnMessage(message)&&!message.isOptimistic&&/*#__PURE__*/_jsx(\"button\",{onClick:()=>handleDeleteMessage(message._id),className:\"text-xs text-gray-500 dark:text-gray-400 mt-1 hover:text-red-500 dark:hover:text-red-400\",children:\"Delete\"})]})]})},message._id);}),/*#__PURE__*/_jsx(\"div\",{ref:messagesEndRef})]}),error&&connectionStatus!=='error'&&/*#__PURE__*/_jsxs(\"div\",{className:\"p-2 mt-2 text-center text-sm text-red-600 dark:text-red-400 bg-red-100 dark:bg-red-900/20 rounded-md flex justify-between items-center\",children:[/*#__PURE__*/_jsx(\"span\",{children:error}),error.includes('connection')&&/*#__PURE__*/_jsx(\"button\",{onClick:handleRetryConnection,className:\"ml-2 text-xs bg-red-600 hover:bg-red-700 text-white px-2 py-1 rounded\",children:\"Retry\"})]})]}),/*#__PURE__*/_jsx(\"div\",{className:\"p-3 border-t border-gray-200 dark:border-gray-700 bg-white dark:bg-gray-800\",children:/*#__PURE__*/_jsxs(\"form\",{onSubmit:handleSendMessage,className:\"flex\",children:[/*#__PURE__*/_jsx(\"input\",{type:\"text\",value:newMessage,onChange:e=>setNewMessage(e.target.value),placeholder:connectionStatus==='connected'?\"Type a message...\":\"Connection lost...\",className:\"flex-1 rounded-l-md py-2 px-3 border-r-0 border border-gray-300 dark:border-gray-600 dark:bg-gray-700 dark:text-white focus:ring-primary-500 focus:border-primary-500 dark:focus:ring-primary-400 dark:focus:border-primary-400\",disabled:sending||loading||connectionStatus!=='connected',ref:messageInputRef}),/*#__PURE__*/_jsx(\"button\",{type:\"submit\",className:\"bg-primary-600 dark:bg-primary-700 hover:bg-primary-700 dark:hover:bg-primary-800 text-white font-medium py-2 px-4 rounded-r-md transition duration-150 ease-in-out disabled:opacity-50 disabled:cursor-not-allowed\",disabled:sending||!newMessage.trim()||loading||connectionStatus!=='connected',children:sending?/*#__PURE__*/_jsxs(\"svg\",{className:\"animate-spin -ml-1 h-5 w-5 text-white\",xmlns:\"http://www.w3.org/2000/svg\",fill:\"none\",viewBox:\"0 0 24 24\",children:[/*#__PURE__*/_jsx(\"circle\",{className:\"opacity-25\",cx:\"12\",cy:\"12\",r:\"10\",stroke:\"currentColor\",strokeWidth:\"4\"}),/*#__PURE__*/_jsx(\"path\",{className:\"opacity-75\",fill:\"currentColor\",d:\"M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z\"})]}):/*#__PURE__*/_jsx(\"span\",{children:\"Send\"})})]})}),reconnecting&&connectionStatus==='connecting'&&/*#__PURE__*/_jsx(\"div\",{className:\"absolute inset-0 bg-black bg-opacity-30 dark:bg-opacity-50 flex items-center justify-center\",children:/*#__PURE__*/_jsxs(\"div\",{className:\"bg-white dark:bg-gray-800 p-4 rounded-lg shadow-lg flex flex-col items-center\",children:[/*#__PURE__*/_jsxs(\"svg\",{className:\"animate-spin mb-3 h-8 w-8 text-primary-600 dark:text-primary-400\",xmlns:\"http://www.w3.org/2000/svg\",fill:\"none\",viewBox:\"0 0 24 24\",children:[/*#__PURE__*/_jsx(\"circle\",{className:\"opacity-25\",cx:\"12\",cy:\"12\",r:\"10\",stroke:\"currentColor\",strokeWidth:\"4\"}),/*#__PURE__*/_jsx(\"path\",{className:\"opacity-75\",fill:\"currentColor\",d:\"M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z\"})]}),/*#__PURE__*/_jsx(\"p\",{className:\"text-gray-800 dark:text-gray-200 font-medium\",children:\"Reconnecting to chat...\"})]})})]});};export default Chat;","map":{"version":3,"names":["React","useState","useEffect","useRef","useContext","useCallback","ChatContext","AuthContext","ThemeContext","jsx","_jsx","jsxs","_jsxs","Fragment","_Fragment","Chat","_ref","chatId","title","height","fullWidth","user","darkMode","getChatMessages","sendMessage","deleteMessage","fetchMessages","joinChatRoom","leaveChatRoom","connectionStatus","error","chatError","reconnect","newMessage","setNewMessage","sending","setSending","loading","setLoading","setError","reconnecting","setReconnecting","messagesEndRef","messageInputRef","reconnectTimerRef","messages","previousChatIdRef","isMounted","initChat","current","length","err","console","_messageInputRef$curr","focus","clearTimeout","includes","scrollToBottom","_messagesEndRef$curre","scrollIntoView","behavior","handleSendMessage","e","preventDefault","messageText","trim","_messageInputRef$curr2","message","handleDeleteMessage","messageId","window","confirm","formatMessageTime","timestamp","date","Date","toLocaleTimeString","hour","minute","isOwnMessage","_message$userId","userId","_id","getConnectionStatusIndicator","className","children","concat","onClick","handleRetryConnection","style","xmlns","fill","viewBox","stroke","strokeLinecap","strokeLinejoin","strokeWidth","d","cx","cy","r","map","_message$userId2","_message$userId2$disp","_message$userId3","photo","src","alt","displayName","charAt","createdAt","isOptimistic","ref","onSubmit","type","value","onChange","target","placeholder","disabled"],"sources":["C:/Users/DELL/OneDrive/Desktop/collabeaseproject/collabeasesorce/collabease/client/src/components/Chat.jsx"],"sourcesContent":["import React, { useState, useEffect, useRef, useContext, useCallback } from 'react';\r\nimport { ChatContext } from '../context/ChatContext';\r\nimport { AuthContext } from '../context/AuthContext';\r\nimport { ThemeContext } from '../context/ThemeContext';\r\n\r\nconst Chat = ({ chatId, title, height = '500px', fullWidth = false }) => {\r\n  const { user } = useContext(AuthContext);\r\n  const { darkMode } = useContext(ThemeContext);\r\n  const { \r\n    getChatMessages, \r\n    sendMessage, \r\n    deleteMessage, \r\n    fetchMessages, \r\n    joinChatRoom, \r\n    leaveChatRoom,\r\n    connectionStatus,\r\n    error: chatError,\r\n    reconnect\r\n  } = useContext(ChatContext);\r\n  \r\n  const [newMessage, setNewMessage] = useState('');\r\n  const [sending, setSending] = useState(false);\r\n  const [loading, setLoading] = useState(true);\r\n  const [error, setError] = useState('');\r\n  const [reconnecting, setReconnecting] = useState(false);\r\n  const messagesEndRef = useRef(null);\r\n  const messageInputRef = useRef(null);\r\n  const reconnectTimerRef = useRef(null);\r\n  const messages = getChatMessages(chatId);\r\n  const previousChatIdRef = useRef(chatId);\r\n  \r\n  // Load messages and join chat room\r\n  useEffect(() => {\r\n    let isMounted = true;\r\n    \r\n    const initChat = async () => {\r\n      if (!isMounted) return;\r\n      \r\n      setLoading(true);\r\n      setError('');\r\n      \r\n      try {\r\n        if (chatId && chatId !== previousChatIdRef.current) {\r\n          // Leave previous room if different\r\n          if (previousChatIdRef.current) {\r\n            leaveChatRoom(previousChatIdRef.current);\r\n          }\r\n          // Join new room\r\n          joinChatRoom(chatId);\r\n          previousChatIdRef.current = chatId;\r\n          await fetchMessages(chatId);\r\n        } else if (chatId && !messages.length) {\r\n          // If same room but no messages (first load), join and fetch\r\n          joinChatRoom(chatId);\r\n          await fetchMessages(chatId);\r\n        }\r\n      } catch (err) {\r\n        console.error('Error initializing chat:', err);\r\n        if (isMounted) {\r\n          setError('Failed to load chat. Please try reloading the page.');\r\n        }\r\n      } finally {\r\n        if (isMounted) {\r\n          setLoading(false);\r\n          // Focus the input field\r\n          messageInputRef.current?.focus();\r\n        }\r\n      }\r\n    };\r\n    \r\n    initChat();\r\n    \r\n    // Clean up when unmounting or changing chat\r\n    return () => {\r\n      isMounted = false;\r\n      // Only leave if component is unmounting or chat is changing\r\n      if (chatId && chatId === previousChatIdRef.current) {\r\n        leaveChatRoom(chatId);\r\n      }\r\n      \r\n      // Clear any reconnect timers\r\n      if (reconnectTimerRef.current) {\r\n        clearTimeout(reconnectTimerRef.current);\r\n        reconnectTimerRef.current = null;\r\n      }\r\n    };\r\n  }, [chatId]);\r\n\r\n  // Watch for connection status changes\r\n  useEffect(() => {\r\n    if (connectionStatus === 'connecting') {\r\n      setReconnecting(true);\r\n    } else if (connectionStatus === 'connected') {\r\n      setReconnecting(false);\r\n      if (error && error.includes('connection')) {\r\n        setError('');\r\n      }\r\n    } else if (connectionStatus === 'disconnected' && !reconnecting) {\r\n      setReconnecting(true);\r\n    }\r\n  }, [connectionStatus, error, reconnecting]);\r\n  \r\n  // Update error from context\r\n  useEffect(() => {\r\n    if (chatError) {\r\n      setError(chatError);\r\n    }\r\n  }, [chatError]);\r\n  \r\n  // Scroll to bottom when messages change\r\n  useEffect(() => {\r\n    scrollToBottom();\r\n  }, [messages]);\r\n  \r\n  const scrollToBottom = () => {\r\n    messagesEndRef.current?.scrollIntoView({ behavior: 'smooth' });\r\n  };\r\n  \r\n  const handleSendMessage = async (e) => {\r\n    e.preventDefault();\r\n    const messageText = newMessage.trim();\r\n    \r\n    if (!messageText || sending || connectionStatus !== 'connected') return;\r\n    \r\n    try {\r\n      setSending(true);\r\n      setError('');\r\n      \r\n      // Clear input immediately for better UX\r\n      setNewMessage('');\r\n      \r\n      // Send the message\r\n      await sendMessage(chatId, messageText);\r\n      \r\n      // Focus back on input field\r\n      messageInputRef.current?.focus();\r\n    } catch (err) {\r\n      console.error('Failed to send message:', err);\r\n      setError(err.message || 'Failed to send message. Please try again.');\r\n    } finally {\r\n      setSending(false);\r\n    }\r\n  };\r\n  \r\n  const handleDeleteMessage = async (messageId) => {\r\n    if (!window.confirm('Are you sure you want to delete this message?')) {\r\n      return;\r\n    }\r\n    \r\n    try {\r\n      setError('');\r\n      await deleteMessage(chatId, messageId);\r\n    } catch (err) {\r\n      console.error('Failed to delete message:', err);\r\n      setError(err.message || 'Failed to delete message. Please try again.');\r\n    }\r\n  };\r\n  \r\n  const formatMessageTime = (timestamp) => {\r\n    try {\r\n      const date = new Date(timestamp);\r\n      return date.toLocaleTimeString([], { hour: '2-digit', minute: '2-digit' });\r\n    } catch (err) {\r\n      return '';\r\n    }\r\n  };\r\n  \r\n  // Check if a message was sent by the current user\r\n  const isOwnMessage = (message) => {\r\n    return message.userId?._id === user?._id;\r\n  };\r\n  \r\n  // Connection status indicator\r\n  const getConnectionStatusIndicator = () => {\r\n    switch (connectionStatus) {\r\n      case 'connected':\r\n        return (\r\n          <div className=\"text-xs flex items-center text-green-600 dark:text-green-400\">\r\n            <span className=\"h-2 w-2 rounded-full bg-green-600 dark:bg-green-400 mr-1\"></span>\r\n            Connected\r\n          </div>\r\n        );\r\n      case 'connecting':\r\n        return (\r\n          <div className=\"text-xs flex items-center text-yellow-600 dark:text-yellow-400\">\r\n            <span className=\"h-2 w-2 rounded-full bg-yellow-600 dark:bg-yellow-400 mr-1 animate-pulse\"></span>\r\n            Connecting...\r\n          </div>\r\n        );\r\n      case 'disconnected':\r\n        return (\r\n          <div className=\"text-xs flex items-center text-red-600 dark:text-red-400\">\r\n            <span className={`h-2 w-2 rounded-full bg-red-600 dark:bg-red-400 mr-1 ${reconnecting ? 'animate-pulse' : ''}`}></span>\r\n            {reconnecting ? 'Reconnecting...' : 'Disconnected'}\r\n          </div>\r\n        );\r\n      case 'error':\r\n        return (\r\n          <div className=\"text-xs flex items-center text-red-600 dark:text-red-400\">\r\n            <span className=\"h-2 w-2 rounded-full bg-red-600 dark:bg-red-400 mr-1\"></span>\r\n            Connection Error\r\n            <button \r\n              onClick={handleRetryConnection}\r\n              className=\"ml-2 underline text-primary-600 dark:text-primary-400 hover:text-primary-800 dark:hover:text-primary-300\"\r\n            >\r\n              Retry\r\n            </button>\r\n          </div>\r\n        );\r\n      default:\r\n        return null;\r\n    }\r\n  };\r\n  \r\n  // Handle retry connection\r\n  const handleRetryConnection = useCallback(() => {\r\n    setReconnecting(true);\r\n    setError('');\r\n    reconnect();\r\n  }, [reconnect]);\r\n  \r\n  return (\r\n    <div \r\n      className={`flex flex-col rounded-lg shadow-md border border-gray-200 dark:border-gray-700 bg-white dark:bg-gray-800 overflow-hidden ${\r\n        fullWidth ? 'w-full' : 'max-w-3xl'\r\n      }`}\r\n      style={{ height }}\r\n    >\r\n      {/* Chat header */}\r\n      <div className=\"p-3 border-b border-gray-200 dark:border-gray-700 bg-gray-50 dark:bg-gray-700 flex justify-between items-center\">\r\n        <h3 className=\"font-medium dark:text-white\">{title || 'Chat'}</h3>\r\n        {getConnectionStatusIndicator()}\r\n      </div>\r\n      \r\n      {/* Chat messages */}\r\n      <div className=\"flex-1 overflow-y-auto p-4 bg-gray-50 dark:bg-gray-800\">\r\n        {loading ? (\r\n          <div className=\"flex justify-center items-center h-full\">\r\n            <div className=\"linear-spinner dark:border-gray-600 dark:border-t-primary-400\"></div>\r\n          </div>\r\n        ) : connectionStatus === 'error' ? (\r\n          <div className=\"flex flex-col items-center justify-center h-full text-gray-600 dark:text-gray-400\">\r\n            <svg xmlns=\"http://www.w3.org/2000/svg\" className=\"h-12 w-12 mb-3 text-red-500 dark:text-red-400\" fill=\"none\" viewBox=\"0 0 24 24\" stroke=\"currentColor\">\r\n              <path strokeLinecap=\"round\" strokeLinejoin=\"round\" strokeWidth={1.5} d=\"M12 9v2m0 4h.01m-6.938 4h13.856c1.54 0 2.502-1.667 1.732-3L13.732 4c-.77-1.333-2.694-1.333-3.464 0L3.34 16c-.77 1.333.192 3 1.732 3z\" />\r\n            </svg>\r\n            <p className=\"text-center mb-2\">Connection lost to the chat server</p>\r\n            <button \r\n              onClick={handleRetryConnection}\r\n              className=\"px-4 py-2 bg-primary-600 hover:bg-primary-700 text-white rounded-md transition-colors duration-150 flex items-center\"\r\n            >\r\n              {reconnecting ? (\r\n                <>\r\n                  <svg className=\"animate-spin -ml-1 mr-2 h-4 w-4 text-white\" xmlns=\"http://www.w3.org/2000/svg\" fill=\"none\" viewBox=\"0 0 24 24\">\r\n                    <circle className=\"opacity-25\" cx=\"12\" cy=\"12\" r=\"10\" stroke=\"currentColor\" strokeWidth=\"4\"></circle>\r\n                    <path className=\"opacity-75\" fill=\"currentColor\" d=\"M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z\"></path>\r\n                  </svg>\r\n                  Reconnecting...\r\n                </>\r\n              ) : (\r\n                'Reconnect'\r\n              )}\r\n            </button>\r\n          </div>\r\n        ) : messages.length === 0 ? (\r\n          <div className=\"flex flex-col items-center justify-center h-full text-gray-500 dark:text-gray-400\">\r\n            <svg xmlns=\"http://www.w3.org/2000/svg\" className=\"h-12 w-12 mb-2\" fill=\"none\" viewBox=\"0 0 24 24\" stroke=\"currentColor\">\r\n              <path strokeLinecap=\"round\" strokeLinejoin=\"round\" strokeWidth={1} d=\"M8 12h.01M12 12h.01M16 12h.01M21 12c0 4.418-4.03 8-9 8a9.863 9.863 0 01-4.255-.949L3 20l1.395-3.72C3.512 15.042 3 13.574 3 12c0-4.418 4.03-8 9-8s9 3.582 9 8z\" />\r\n            </svg>\r\n            <p>No messages yet</p>\r\n            <p className=\"text-sm mt-1\">Start the conversation!</p>\r\n          </div>\r\n        ) : (\r\n          <div className=\"space-y-4\">\r\n            {messages.map((message) => (\r\n              <div \r\n                key={message._id} \r\n                className={`flex ${isOwnMessage(message) ? 'justify-end' : 'justify-start'}`}\r\n              >\r\n                <div className={`flex max-w-[80%] ${isOwnMessage(message) ? 'flex-row-reverse' : ''}`}>\r\n                  {/* Avatar */}\r\n                  <div className=\"flex-shrink-0\">\r\n                    <div className=\"linear-avatar linear-avatar-sm dark:bg-gray-700\">\r\n                      {message.userId && message.userId.photo ? (\r\n                        <img \r\n                          src={message.userId.photo} \r\n                          alt={message.userId.displayName || 'User'} \r\n                          className=\"h-full w-full object-cover rounded-full\"\r\n                        />\r\n                      ) : (\r\n                        <span>{message.userId?.displayName?.charAt(0) || '?'}</span>\r\n                      )}\r\n                    </div>\r\n                  </div>\r\n                  \r\n                  {/* Message content */}\r\n                  <div className={`mx-2 ${isOwnMessage(message) ? 'text-right' : ''}`}>\r\n                    <div className=\"flex items-center mb-1\">\r\n                      <p className={`text-xs text-gray-500 dark:text-gray-400 ${isOwnMessage(message) ? 'mr-2' : 'ml-0 mr-2'}`}>\r\n                        {formatMessageTime(message.createdAt)}\r\n                      </p>\r\n                      <p className=\"text-sm font-medium dark:text-white\">\r\n                        {message.userId?.displayName || 'Anonymous'}\r\n                      </p>\r\n                    </div>\r\n                    <div className={`rounded-lg p-3 ${isOwnMessage(message)\r\n                        ? 'bg-primary-100 dark:bg-primary-900/30 text-gray-900 dark:text-gray-100'\r\n                        : 'bg-gray-100 dark:bg-gray-700 text-gray-900 dark:text-gray-100'\r\n                      } ${message.isOptimistic ? 'opacity-70' : ''}`}\r\n                    >\r\n                      <p className=\"text-sm whitespace-pre-wrap break-words\">{message.message}</p>\r\n                    </div>\r\n                    \r\n                    {/* Delete option for own messages */}\r\n                    {isOwnMessage(message) && !message.isOptimistic && (\r\n                      <button\r\n                        onClick={() => handleDeleteMessage(message._id)}\r\n                        className=\"text-xs text-gray-500 dark:text-gray-400 mt-1 hover:text-red-500 dark:hover:text-red-400\"\r\n                      >\r\n                        Delete\r\n                      </button>\r\n                    )}\r\n                  </div>\r\n                </div>\r\n              </div>\r\n            ))}\r\n            <div ref={messagesEndRef} />\r\n          </div>\r\n        )}\r\n        \r\n        {error && connectionStatus !== 'error' && (\r\n          <div className=\"p-2 mt-2 text-center text-sm text-red-600 dark:text-red-400 bg-red-100 dark:bg-red-900/20 rounded-md flex justify-between items-center\">\r\n            <span>{error}</span>\r\n            {error.includes('connection') && (\r\n              <button \r\n                onClick={handleRetryConnection}\r\n                className=\"ml-2 text-xs bg-red-600 hover:bg-red-700 text-white px-2 py-1 rounded\"\r\n              >\r\n                Retry\r\n              </button>\r\n            )}\r\n          </div>\r\n        )}\r\n      </div>\r\n      \r\n      {/* Message input */}\r\n      <div className=\"p-3 border-t border-gray-200 dark:border-gray-700 bg-white dark:bg-gray-800\">\r\n        <form onSubmit={handleSendMessage} className=\"flex\">\r\n          <input\r\n            type=\"text\"\r\n            value={newMessage}\r\n            onChange={(e) => setNewMessage(e.target.value)}\r\n            placeholder={connectionStatus === 'connected' ? \"Type a message...\" : \"Connection lost...\"}\r\n            className=\"flex-1 rounded-l-md py-2 px-3 border-r-0 border border-gray-300 dark:border-gray-600 dark:bg-gray-700 dark:text-white focus:ring-primary-500 focus:border-primary-500 dark:focus:ring-primary-400 dark:focus:border-primary-400\"\r\n            disabled={sending || loading || connectionStatus !== 'connected'}\r\n            ref={messageInputRef}\r\n          />\r\n          <button\r\n            type=\"submit\"\r\n            className=\"bg-primary-600 dark:bg-primary-700 hover:bg-primary-700 dark:hover:bg-primary-800 text-white font-medium py-2 px-4 rounded-r-md transition duration-150 ease-in-out disabled:opacity-50 disabled:cursor-not-allowed\"\r\n            disabled={sending || !newMessage.trim() || loading || connectionStatus !== 'connected'}\r\n          >\r\n            {sending ? (\r\n              <svg className=\"animate-spin -ml-1 h-5 w-5 text-white\" xmlns=\"http://www.w3.org/2000/svg\" fill=\"none\" viewBox=\"0 0 24 24\">\r\n                <circle className=\"opacity-25\" cx=\"12\" cy=\"12\" r=\"10\" stroke=\"currentColor\" strokeWidth=\"4\"></circle>\r\n                <path className=\"opacity-75\" fill=\"currentColor\" d=\"M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z\"></path>\r\n              </svg>\r\n            ) : (\r\n              <span>Send</span>\r\n            )}\r\n          </button>\r\n        </form>\r\n      </div>\r\n      \r\n      {/* Overlay for reconnecting state */}\r\n      {reconnecting && connectionStatus === 'connecting' && (\r\n        <div className=\"absolute inset-0 bg-black bg-opacity-30 dark:bg-opacity-50 flex items-center justify-center\">\r\n          <div className=\"bg-white dark:bg-gray-800 p-4 rounded-lg shadow-lg flex flex-col items-center\">\r\n            <svg className=\"animate-spin mb-3 h-8 w-8 text-primary-600 dark:text-primary-400\" xmlns=\"http://www.w3.org/2000/svg\" fill=\"none\" viewBox=\"0 0 24 24\">\r\n              <circle className=\"opacity-25\" cx=\"12\" cy=\"12\" r=\"10\" stroke=\"currentColor\" strokeWidth=\"4\"></circle>\r\n              <path className=\"opacity-75\" fill=\"currentColor\" d=\"M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z\"></path>\r\n            </svg>\r\n            <p className=\"text-gray-800 dark:text-gray-200 font-medium\">Reconnecting to chat...</p>\r\n          </div>\r\n        </div>\r\n      )}\r\n    </div>\r\n  );\r\n};\r\n\r\nexport default Chat; "],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}